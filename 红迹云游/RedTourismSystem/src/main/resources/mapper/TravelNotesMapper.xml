<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.redtourism.mapper.TravelNotesMapper">

    <select id="selectAll" resultType="TravelNotes">
        SELECT * FROM travel_notes
    </select>

    <select id="selectById" resultType="TravelNotes">
        SELECT * FROM travel_notes WHERE id = #{id}
    </select>

    <insert id="insert" parameterType="com.redtourism.entity.TravelNotes" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO travel_notes(title, author, content, view_count, favorite_count, place, images, ban_image, createtime, video,  user_id)
        VALUES (#{title}, #{author}, #{content}, #{viewCount}, #{favoriteCount}, #{place},  #{images}, #{banImage}, NOW(), #{video}, #{userId})
    </insert>


    <select id="selectByUserId" resultType="TravelNotes">
        SELECT * FROM travel_notes WHERE user_id = #{userId}
    </select>



    <select id="selectByRouteId" resultType="TravelNotes">
        SELECT ss.* FROM travel_notes ss
              JOIN travel_notes rs ON ss.id = rs.travel_notes
        WHERE rs.route_id = #{routeId}
        ORDER BY rs.sort_order ASC
    </select>

    <update id="updateAuthor" parameterType="com.redtourism.entity.TravelNotes">
        UPDATE travel_notes
        SET author = #{author}
        WHERE id = #{id}
    </update>


    <update id="update" parameterType="com.redtourism.entity.TravelNotes">
        UPDATE travel_notes
        SET title = #{title},
            content = #{content},
            place = #{place},
            ban_image = #{banImage},
            images = #{images},
            video = #{video}
        WHERE id = #{id}
    </update>

    <delete id="delete">
        DELETE FROM travel_notes WHERE id = #{id}
    </delete>

    <select id="getFavoriteCount" resultType="java.lang.Integer">
    SELECT favorite_count
    FROM travel_notes
    WHERE id = #{travelNotesId}
</select>



    <update id="increaseViewCount">
        UPDATE travel_notes SET view_count = view_count + 1 WHERE id = #{id}
    </update>

    <update id="increaseFavoriteCount">
        UPDATE travel_notes SET favorite_count = favorite_count + 1 WHERE id = #{id}
    </update>

    <update id="decreaseFavoriteCount">
        UPDATE travel_notes SET favorite_count = favorite_count - 1 WHERE id = #{id}
    </update>

    <select id="listTopTravelNotes" resultType="TravelNotes">
        SELECT * FROM travel_notes ORDER BY view_count DESC LIMIT #{limit}
    </select>

    <select id="listFavoritesByUserId" resultType="TravelNotes">
        SELECT ss.* FROM travel_notes ss
                             JOIN favorite f ON ss.id = f.travelnotes_id
        WHERE f.user_id = #{userId}
    </select>




</mapper>